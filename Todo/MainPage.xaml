<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Todo.MainPage"
             Title="Задачи">

    <Grid RowSpacing="8" ColumnSpacing="0" Padding="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header: filter + add -->
        <HorizontalStackLayout Grid.Row="0" HorizontalOptions="Fill" VerticalOptions="Center">
            <Picker x:Name="FilterPicker" WidthRequest="180" Title="Фильтр" SelectedIndexChanged="OnFilterChanged">
                <Picker.Items>
                    <x:String>Текущие</x:String>
                    <x:String>Выполненные</x:String>
                    <x:String>Все</x:String>
                </Picker.Items>
            </Picker>

            <Button Text="Добавить" Clicked="OnAddClicked" HorizontalOptions="EndAndExpand" />
        </HorizontalStackLayout>

        <!-- Empty label -->
        <Label x:Name="EmptyLabel" Grid.Row="1" Text="Нет запланированных задач" IsVisible="False" HorizontalOptions="Center" VerticalOptions="Center" />

        <!-- List -->
        <CollectionView x:Name="TasksCollection" Grid.Row="2" SelectionMode="None" VerticalOptions="FillAndExpand">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems Mode="Execute">
                                <SwipeItem Text="Редактировать" Invoked="OnEditInvoked" CommandParameter="{Binding .}" />
                                <SwipeItem Text="Удалить" Invoked="OnDeleteInvoked" CommandParameter="{Binding .}" BackgroundColor="Crimson" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <!-- Fixed-height item to avoid layout collapse on Android -->
                        <Frame Margin="0,4" Padding="8" HasShadow="True" VerticalOptions="Start" HeightRequest="72" MinimumHeightRequest="72">

                            <HorizontalStackLayout VerticalOptions="Center">
                                <CheckBox IsChecked="{Binding IsCompleted}" CheckedChanged="OnCheckBoxChanged" BindingContext="{Binding .}" VerticalOptions="Center" />

                                <VerticalStackLayout Padding="8,0" VerticalOptions="Center">
                                    <!-- Tap only on text area to open editor -->
                                    <VerticalStackLayout.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnItemTapped" CommandParameter="{Binding .}" NumberOfTapsRequired="1" />
                                    </VerticalStackLayout.GestureRecognizers>

                                    <Label Text="{Binding Title}" FontAttributes="Bold" />
                                    <Label Text="{Binding Description}" LineBreakMode="TailTruncation" />
                                </VerticalStackLayout>
                            </HorizontalStackLayout>
                        </Frame>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>

</ContentPage>
